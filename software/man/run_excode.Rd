% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/run_excode.R
\name{run_excode}
\alias{run_excode}
\title{Detect excess counts in epidemiological time series}
\usage{
run_excode(
  surv_ts,
  timepoints = NULL,
  time_units_back = 5,
  distribution,
  states,
  time_trend = "None",
  periodic_model = "Harmonic",
  period_length = 52,
  intercept = TRUE,
  covariate_df = NULL,
  weights_threshold = 2.58,
  weights_threshold_baseline = 1,
  set_baseline_state = FALSE,
  maxIter = 100,
  verbose = FALSE,
  return_full_model = FALSE
)
}
\arguments{
\item{surv_ts}{\code{data.frame} surveillance time series as described in \emph{Details}.}

\item{timepoints}{Integer or integer vector of time points at which to perform detection; must be provided unless embedded in a \code{MultiState} formula.}

\item{time_units_back}{Integer number of past time \emph{units} used for fitting (interpreted relative to \code{timepoints_per_unit} in the model’s \code{excodeFormula}); default \code{5}.}

\item{distribution}{Character emission family passed to \code{excodeFamily()}, e.g., \code{"Poisson"} or \code{"NegBinom"}.}

\item{states}{Integer (>= 2) number of latent states for initialization/fitting.}

\item{time_trend}{Character time-trend specification forwarded to \code{excodeFormula()}, one of \code{c("Linear","Spline1","Spline2","Spline3","Spline4","None")}; default \code{"None"}.}

\item{periodic_model}{Character background model name forwarded to \code{excodeFormula()}, one of \code{c("Mean","FarringtonNoufaily","Harmonic","Custom")}; default \code{"Harmonic"}.}

\item{period_length}{Integer number of time points per unit season used as \code{timepoints_per_unit} in \code{excodeFormula()} (e.g., \code{52} weekly per year, \code{365} daily per year); default \code{52}.}

\item{intercept}{Logical; include an intercept in the constructed formulas; default \code{TRUE}.}

\item{covariate_df}{\code{data.frame} or \code{NULL}; optional covariates used when constructing \code{excodeFormula()}; default \code{NULL}.}

\item{weights_threshold}{Numeric SD cutoff for \code{surveillance::algo.farrington.assign.weights()} when down-weighting residuals in the baseline refit; default \code{2.58}.}

\item{weights_threshold_baseline}{Numeric Anscombe residual cutoff used to mark non-baseline points for clustering during initialization; default \code{1}.}

\item{set_baseline_state}{Logical; if \code{TRUE}, compute/assign the background state after initialization; default \code{FALSE}.}

\item{maxIter}{Integer maximum number of EM iterations; default \code{100}.}

\item{verbose}{Logical; print progress; default \code{FALSE}.}

\item{return_full_model}{Logical; if \code{FALSE} (default) return results only for the requested \code{timepoints}; if \code{TRUE}, return the full time series used for fitting at each \code{timepoint}.}
}
\value{
A fitted \code{\linkS4class{excodeModel}} containing, for the requested time points (or the full series if \code{return_full_model = TRUE}), posterior state probabilities, fitted means, p-values, Anscombe residuals, convergence information, and information criteria.
}
\description{
Fits an \code{\linkS4class{excodeModel}} to surveillance data and returns a fitted model with posterior state probabilities, fitted means, and diagnostics for excess-count detection; supports a single time series provided as a \code{data.frame}.
}
\details{
The input \code{surv_ts} must be a \code{data.frame} with columns: \strong{date} (aggregation date), \strong{observed} (case counts), optional \strong{offset} (e.g., population at risk), and optional \strong{state} (e.g., 0 = background, 1 = excess, \code{NA} = unknown). Passing \code{sts} objects (from \pkg{surveillance}), lists of \code{sts}, or matrix-like collections of \code{sts} is not supported. If the model’s emission uses a \code{MultiState} \code{excodeFormula} that already contains a \code{surv_ts} slot, \code{run_excode()} uses that data and, if missing, sets \code{timepoints} accordingly.
}
\examples{

data(shadar_df)
res_har_pois <- run_excode(
  surv_ts = shadar_df,
  timepoints = 295,
  distribution = "Poisson",
  states = 2,
  periodic_model = "Harmonic",
  time_trend = "Linear",
  set_baseline_state = TRUE
)

}
\seealso{
\code{\linkS4class{excodeModel}}, \code{\linkS4class{excodeFamily}}, \code{\linkS4class{excodeFormula}}
}
