% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/run_excode.R
\name{run_excode}
\alias{run_excode}
\title{Detect Excess Counts in Epidemiological Time Series}
\usage{
run_excode(
  surv_ts,
  timepoints = NULL,
  time_units_back = 5,
  distribution,
  states,
  time_trend = "None",
  periodic_model = "Harmonic",
  period_length = 52,
  intercept = TRUE,
  covariate_df = NULL,
  weights_threshold = 2.58,
  weights_threshold_baseline = 1,
  set_baseline_state = FALSE,
  maxIter = 100,
  verbose = FALSE,
  return_full_model = FALSE
)
}
\arguments{
\item{surv_ts}{A \code{data.frame} as specified under \emph{Details}.}

\item{timepoints}{An \code{integer} or integer vector specifying the time points
at which excess-count detection should be performed. If \code{NULL} and the model
embeds a \code{surv_ts} via a \code{MultiState} formula, an appropriate default is chosen.}

\item{time_units_back}{\code{integer}. How many past time \emph{units} to include when fitting.
Default \code{5}. For example, if \code{timepoints_per_unit = 52} (weekly data, units = years)
in the \code{excodeFormula}, then \code{5} corresponds to the past 5 years; if
\code{timepoints_per_unit = 7} (daily data, units = weeks), then \code{5} corresponds to the
past 5 weeks.}

\item{maxIter}{\code{integer}. Maximum number of EM iterations. Defaults to \code{100}.}

\item{verbose}{\code{logical}. Print progress during execution. Defaults to \code{FALSE}.}

\item{return_full_model}{\code{logical}. If \code{FALSE} (default), return only results
for the specified \code{timepoints}. If \code{TRUE}, return the complete time series used
for fitting.
to exclude from initialization. Defaults to \code{26}. For daily data this excludes the past
\emph{x} days; for weekly data, the past \emph{x} weeks.}

\item{excode_model}{An object of class \code{\linkS4class{excodeModel}}
specifying the model family and formula as well as initial parameters/structure.}
}
\value{
A fitted \code{\linkS4class{excodeModel}} object containing, for the requested
time points (or the full series if \code{return_full_model = TRUE}), posterior state
probabilities, fitted means, p-values, Anscombe residuals, convergence information, and
information criteria.
}
\description{
Fit an \code{\linkS4class{excodeModel}} to epidemiological surveillance data
and return a fitted model (with posterior probabilities, fitted means, and
related diagnostics) for detecting excess counts. Supports single or multiple
time series provided as a \code{data.frame} only.
}
\details{
The function currently accepts a single \code{data.frame} as the surveillance
time series input. The \code{data.frame} must contain:
\itemize{
  \item \strong{date}: aggregation date;
  \item \strong{observed}: observed case counts;
  \item \strong{id}: identifier of the time series (use a single id for one series);
  \item \strong{offset} (optional): e.g., population at risk;
  \item \strong{state} (optional): periods with special events (e.g., 0 = normal,
        1 = excess, \code{NA} = unknown).
}

It is no longer possible to pass \code{sts} objects (from the
\pkg{surveillance} package) or lists of such objects. These will result in an
error. A matrix-like collection of \code{sts} objects (e.g.,
\code{surveillance::measlesDE}) is also not supported.

If the model's emission uses a \code{MultiState} \code{excodeFormula} that
already contains a \code{surv_ts} slot, \code{run_excode()} will use that data
and (if not supplied) set \code{timepoints} accordingly.
}
\examples{
# Create a Poisson harmonic model
excode_family_pois <- excodeFamily("Poisson")
excode_formula_har <- excodeFormula("Harmonic")
excode_har_pois <- excodeModel(excode_family_pois, excode_formula_har)

# Example: data.frame as input
data(shadar_df)
result_shadar_har <- run_excode(excode_har_pois, shadar_df, 209:295)

}
\seealso{
\code{\linkS4class{excodeModel}}, \code{\linkS4class{excodeFamily}}, \code{\linkS4class{excodeFormula}}
}
